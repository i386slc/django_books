# 1.5 Обработка зависимостей проекта с помощью pip

Самый удобный инструмент для установки и управления пакетами Python — **pip**. Вместо того, чтобы устанавливать пакеты один за другим, можно определить список пакетов, которые вы хотите установить, в виде содержимого текстового файла. Мы можем передать текстовый файл в инструмент **pip**, который затем автоматически выполнит установку всех пакетов в списке. Дополнительным преимуществом этого подхода является то, что список пакетов может храниться в системе управления версиями.

Вообще говоря, идеально и часто достаточно иметь один файл требований, который непосредственно соответствует вашей производственной среде. Вы можете изменять версии или добавлять и удалять зависимости на машине разработки, а затем управлять ими с помощью контроля версий. Таким образом, переход от одного набора зависимостей (и связанных с ними изменений кода) к другому может быть таким же простым, как переключение ветвей.

В некоторых случаях среды настолько различаются, что вам потребуется как минимум два разных экземпляра вашего проекта:

* Среда разработки, в которой вы создаете новые функции
* Среда общедоступного веб-сайта, которую обычно называют рабочей средой на размещенном сервере.

Могут быть среды разработки для других разработчиков или специальные инструменты, которые необходимы во время разработки, но не нужны в рабочей среде. У вас также может быть тестовая и промежуточная среда для тестирования проекта локально и на общедоступном веб-сайте.

Для хорошей ремонтопригодности вы должны иметь возможность установить необходимые модули Python для разработки, тестирования, промежуточной и производственной сред. Некоторые из модулей будут общими, а некоторые из них будут специфичными для подмножества сред. В этом рецепте мы узнаем, как организовать зависимости проекта для нескольких сред и управлять ими с помощью **pip**.

## Подготовка

Прежде чем использовать этот рецепт, вам нужно подготовить проект Django с установленным **pip** и активированной виртуальной средой. Подробнее о том, как это сделать, читайте в рецепте [Работа с виртуальной средой](1.3-rabota-s-virtualnoi-sredoi.md).

## Как это сделать...

Выполните следующие шаги один за другим, чтобы подготовить требования к **pip** для вашего проекта виртуальной среды Django:

1. Давайте перейдем к проекту Django, который находится под контролем версий, и создадим каталог **requirements** со следующими текстовыми файлами:

* `_base.txt` для общих модулей
* `dev.txt` для среды разработки
* `test.txt` для среды тестирования
* `staging.txt` для промежуточной среды
* `production.txt` для производства

2\. Отредактируйте `_base.txt` и добавьте модули Python, которые являются общими для всех сред, построчно:

```bash
# requirements/_base.txt
Django~=3.0.4
djangorestframework
-e git://github.com/omab/python-socialauth.git@6b1e301c79#egg=python-social-auth
```

3\. Если требования конкретной среды такие же, как в `_base.txt`, добавьте строку, включающую **\_base.txt**, в файл требований этой среды, как показано в следующем примере:

```bash
# requirements/production.txt
-r _base.txt
```

4\. Если есть особые требования к среде, добавьте их после включения `_base.txt`, как показано в следующем коде:

```bash
# requirements/dev.txt
-r _base.txt
coverage
django-debug-toolbar
selenium
```

5\. Вы можете запустить следующую команду в виртуальной среде, чтобы установить все необходимые зависимости для среды разработки (или аналогичную команду для других сред):

```bash
(env)$ pip install -r requirements/dev.txt
```

## Как это работает...

Предыдущая команда `pip install`, независимо от того, выполняется ли она явно в виртуальной среде или на глобальном уровне, загружает и устанавливает все зависимости вашего проекта из `requirements/_base.txt` и `requirements/dev.txt`. Как видите, вы можете указать версию модуля, которая вам нужна для фреймворка **Django**, и даже напрямую установить его из определенного коммита в репозитории Git, как это сделано для **python-social-auth** в нашем примере.

Если в вашем проекте много зависимостей, рекомендуется придерживаться узкого диапазона версий выпуска для выпусков модулей Python. Тогда вы можете быть более уверены в том, что целостность проекта не будет нарушена из-за обновлений ваших зависимостей, которые могут содержать конфликты или обратную несовместимость. Это особенно важно при развертывании вашего проекта или передаче его новому разработчику.

Если вы уже вручную установили требования проекта с помощью **pip** один за другим, вы можете сгенерировать файл `requirements/_base.txt`, используя следующую команду в своей виртуальной среде:

```bash
(env)$ pip freeze > requirements/_base.txt
```

## Есть еще кое-что...

Если вы хотите, чтобы все было просто, и уверены, что для всех сред вы будете использовать одни и те же зависимости, вы можете использовать для своих требований только один файл с именем `requirements.txt`, сгенерированный по определению, как показано ниже:

```bash
(env)$ pip freeze > requirements.txt
```

Чтобы установить модули в новую виртуальную среду, просто используйте следующую команду:

```bash
(env)$ pip install -r requirements.txt
```

Если вам нужно установить библиотеку Python из другой системы контроля версий или по локальному пути, то вы можете узнать больше о **pip** из официальной документации по [адресу](https://pip.pypa.io/en/stable/user\_guide/).

Другой подход к управлению зависимостями Python, который становится все более и более популярным, — это **Pipenv**. Вы можете получить его и узнать о нем на [https://github.com/pypa/pipenv](https://github.com/pypa/pipenv).

## Смотрите также

* Рецепт [Работа с виртуальной средой](1.3-rabota-s-virtualnoi-sredoi.md)
* Рецепт Работа с контейнерами Docker для Django, Gunicorn, Nginx и PostgreSQL
* Рецепт включения внешних зависимостей в ваш проект
* Рецепт [Настройка параметров для среды разработки, тестирования, промежуточной и производственной среды](1.6-nastroika-parametrov-dlya-sredy-razrabotki-testirovaniya-promezhutochnoi-i-proizvodstvennoi-sred.md)

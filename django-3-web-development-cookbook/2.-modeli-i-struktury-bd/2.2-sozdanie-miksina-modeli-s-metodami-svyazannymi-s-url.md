# 2.2 Создание миксина модели с методами, связанными с URL

Для каждой модели, у которой есть отдельная страница сведений, рекомендуется определить метод `get_absolute_url()`. Этот метод можно использовать в шаблонах, а также на сайте администратора Django для предварительного просмотра сохраненного объекта. Однако `get_absolute_url()` неоднозначна, так как возвращает URL-адрес вместо полного URL-адреса.

В этом рецепте мы рассмотрим, как создать миксин модели, обеспечивающий упрощенную поддержку URL-адресов, специфичных для модели. Этот миксин позволит вам сделать следующее:

* Позволяет вам определить путь URL-адреса или полный URL-адрес в вашей модели.
* Автоматически генерирует другой URL-адрес на основе того, который вы определили.
* Определяет метод `get_absolute_url()` за кулисами

## Подготовка

Если вы еще этого не сделали, создайте приложение **myproject.apps.core**, в котором вы будете хранить примеси моделей. Затем создайте файл **models.py** в основном пакете **core**. В качестве альтернативы, если вы создаете повторно используемое приложение, поместите примеси в файл **base.py** в этом приложении.

## Как это сделать...

Выполните следующие шаги, один за другим:

1. Добавьте следующее содержимое в файл **models.py** вашего приложения **core**:

```python
# myproject/apps/core/models.py
from urllib.parse import urlparse, urlunparse
from django.conf import settings
from django.db import models

class UrlBase(models.Model):
    """
    Замена get_absolute_url() Модели, расширяющие этот миксин,
    должны иметь реализацию get_url или get_url_path.
    """
    class Meta:
        abstract = True

    def get_url(self):
        if hasattr(self.get_url_path, "dont_recurse"):
            raise NotImplementedError
        try:
            path = self.get_url_path()
        except NotImplementedError:
            raise
        return settings.WEBSITE_URL + path
    get_url.dont_recurse = True

    def get_url_path(self):
        if hasattr(self.get_url, "dont_recurse"):
            raise NotImplementedError
        try:
            url = self.get_url()
        except NotImplementedError:
            raise
        bits = urlparse(url)
        return urlunparse(("", "") + bits[2:])
    get_url_path.dont_recurse = True

    def get_absolute_url(self):
        return self.get_url()
```
